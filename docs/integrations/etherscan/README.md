# Etherscan API - Complete Documentation

**Autonomously Generated**: 2025-12-21
**Source**: https://docs.etherscan.io/introduction
**Generated By**: TheWarden Autonomous Explorer

## üéØ Overview

Comprehensive documentation of the Etherscan API covering all modules, endpoints, and integration patterns for TheWarden's intelligence systems.

**Coverage**: 60+ EVM chains, 9 modules, 30+ endpoints

---

## üìö Table of Contents

1. [Quick Start](#quick-start)
2. [API Modules](#api-modules)
3. [Multichain Support](#multichain-support)
4. [Rate Limits](#rate-limits)
5. [Authentication](#authentication)
6. [Integration Guide](#integration-guide)
7. [Best Practices](#best-practices)

---

## üöÄ Quick Start

### Installation

Already included in TheWarden dependencies.

### Configuration

```bash
# Add to .env
ETHERSCAN_API_KEY=your_ethereum_key
BASESCAN_API_KEY=your_base_key
ARBISCAN_API_KEY=your_arbitrum_key
```

Get keys from:
- **Ethereum**: https://etherscan.io/myapikey
- **Base**: https://basescan.org/myapikey  
- **Arbitrum**: https://arbiscan.io/myapikey

### Basic Usage

```typescript
import { EtherscanClient } from '@/intelligence/etherscan';

const client = new EtherscanClient({
  apiKey: process.env.ETHERSCAN_API_KEY!,
  chain: 'ethereum'
});

// Get balance
const balance = await client.account.getBalance('0x...');

// Get contract ABI
const abi = await client.contract.getABI('0x...');

// Monitor gas
const gas = await client.gas.getOracle();
```

---

## üì¶ API Modules

### 1. Accounts Module

**Purpose**: Access account balances, transactions, and token holdings

**Endpoints**:
- `balance` - Get ETH balance for single address
- `balancemulti` - Get balances for multiple addresses (max 20)
- `txlist` - Get normal transactions
- `txlistinternal` - Get internal transactions
- `tokentx` - Get ERC-20 token transfers
- `tokennfttx` - Get ERC-721 NFT transfers
- `getminedblocks` - Get blocks mined by address

**TheWarden Use Cases**:
- Portfolio tracking across wallets
- Transaction history analysis
- Token holding monitoring
- Arbitrage wallet balance checks

**Example**:
```typescript
// Get wallet balance
const balance = await client.account.getBalance('0x742d35Cc6634C0532925a3b844Bc9e7595f0bEb');

// Get recent transactions
const txs = await client.account.getTransactions('0x...', {
  page: 1,
  offset: 100,
  sort: 'desc'
});

// Get token transfers
const tokens = await client.account.getTokenTransfers('0x...');
```

---

### 2. Contracts Module

**Purpose**: Retrieve smart contract information and verify contracts

**Endpoints**:
- `getabi` - Get contract ABI (verified contracts only)
- `getsourcecode` - Get source code and metadata
- `getcontractcreation` - Get contract creation transaction

**TheWarden Use Cases**:
- Verify DEX contract ABIs before interaction
- Analyze contract source for safety
- Track contract deployment history
- Automated contract verification

**Example**:
```typescript
// Get Uniswap V3 Router ABI
const abi = await client.contract.getABI('0xE592427A0AEce92De3Edee1F18E0157C05861564');

// Check if contract is verified
const source = await client.contract.getSourceCode('0x...');
if (source[0].SourceCode) {
  console.log('Contract verified ‚úÖ');
}
```

---

### 3. Transactions Module

**Purpose**: Query transaction details and execution status

**Endpoints**:
- `getstatus` - Check transaction execution status (0=fail, 1=pass)
- `gettxreceiptstatus` - Get transaction receipt status

**TheWarden Use Cases**:
- Monitor arbitrage transaction success
- Verify execution before follow-up actions
- Track failed transaction patterns

**Example**:
```typescript
// Check if transaction succeeded
const status = await client.transaction.getStatus('0xtxhash...');
if (status.isError === '0') {
  console.log('Transaction successful ‚úÖ');
}
```

---

### 4. Blocks Module

**Purpose**: Access block-level data and rewards

**Endpoints**:
- `getblockreward` - Get block and uncle rewards
- `getblockcountdown` - Estimate time to specific block
- `getblocknobytime` - Get block number by timestamp

**TheWarden Use Cases**:
- Timing predictions for arbitrage
- Historical block analysis
- Reward tracking for validators

**Example**:
```typescript
// Estimate when block 99999999 will be reached
const countdown = await client.block.getCountdown(99999999);
console.log(`Estimated time: ${countdown.EstimateTimeInSec} seconds`);
```

---

### 5. Logs Module

**Purpose**: Query event logs from smart contracts

**Endpoints**:
- `getLogs` - Get filtered event logs by address and topics

**TheWarden Use Cases**:
- Monitor DEX swap events for arbitrage
- Track liquidity changes
- Detect flash loan opportunities
- Event-driven strategy triggers

**Example**:
```typescript
// Monitor Uniswap swap events
const logs = await client.logs.getLogs({
  address: UNISWAP_V3_POOL,
  topic0: SWAP_EVENT_SIGNATURE,
  fromBlock: currentBlock - 1000,
  toBlock: 'latest'
});
```

---

### 6. Proxy Module (JSON-RPC)

**Purpose**: Direct Ethereum node-like calls

**Endpoints**:
- `eth_blockNumber` - Get latest block number
- `eth_getBlockByNumber` - Get block data
- `eth_getTransactionByHash` - Get transaction details
- `eth_call` - Execute contract call (no tx)
- `eth_getCode` - Get contract bytecode
- `eth_getStorageAt` - Read contract storage
- `eth_gasPrice` - Get current gas price
- `eth_estimateGas` - Estimate gas for transaction

**TheWarden Use Cases**:
- Direct contract interactions
- Gas estimation for arbitrage
- Custom RPC queries
- Storage slot reading

**Example**:
```typescript
// Get current gas price
const gasPrice = await client.proxy.eth_gasPrice();

// Estimate gas for transaction
const gasEstimate = await client.proxy.eth_estimateGas(
  '0xToAddress',
  '0x0', // value
  '0xEncodedData'
);
```

---

### 7. Tokens Module

**Purpose**: Query token-specific data

**Endpoints**:
- `tokenholderlist` - Get top token holders
- `tokeninfo` - Get token metadata (name, symbol, decimals)

**TheWarden Use Cases**:
- Analyze token distribution
- Track whale movements
- Verify token legitimacy

**Example**:
```typescript
// Get USDC holders
const holders = await client.token.getHolders(USDC_CONTRACT);
```

---

### 8. Gas Tracker Module

**Purpose**: Real-time gas price data

**Endpoints**:
- `gasoracle` - Get current gas prices (safe, propose, fast)
- `gasestimate` - Estimate confirmation time for gas price

**TheWarden Use Cases**:
- Optimize arbitrage transaction timing
- Gas price predictions
- Cost-benefit analysis for trades

**Example**:
```typescript
// Get current gas recommendations
const oracle = await client.gas.getOracle();
console.log(`Fast: ${oracle.FastGasPrice} gwei`);
console.log(`Normal: ${oracle.ProposeGasPrice} gwei`);
console.log(`Slow: ${oracle.SafeGasPrice} gwei`);
```

---

### 9. Stats Module

**Purpose**: Network statistics and historical data

**Endpoints**:
- `ethsupply` - Total ETH supply
- `ethprice` - Current ETH price (USD and BTC)
- `chainsize` - Blockchain database size

**TheWarden Use Cases**:
- Market intelligence
- Network health monitoring
- Price correlation analysis

**Example**:
```typescript
// Get current ETH price
const price = await client.stats.getEthPrice();
console.log(`ETH: $${price.ethusd}`);
```

---

## üåç Multichain Support

Etherscan API supports **60+ EVM-compatible chains** with single API key:

| Chain | Chain ID | Endpoint |
|-------|----------|----------|
| Ethereum | 1 | api.etherscan.io/v2/api |
| Base | 8453 | api.etherscan.io/v2/api |
| Arbitrum | 42161 | api.etherscan.io/v2/api |
| Optimism | 10 | api.etherscan.io/v2/api |
| Polygon | 137 | api.etherscan.io/v2/api |
| BSC | 56 | api.etherscan.io/v2/api |

**Usage**:
```typescript
// Same API, different chains
const baseClient = new EtherscanClient({ 
  apiKey: process.env.BASESCAN_API_KEY!,
  chain: 'base' // chainid: 8453
});

const arbClient = new EtherscanClient({
  apiKey: process.env.ARBISCAN_API_KEY!,
  chain: 'arbitrum' // chainid: 42161
});
```

---

## ‚ö° Rate Limits

### Free Tier
- **5 calls/second**
- **100,000 calls/day**
- All standard endpoints

### Pro Tier  
- Higher rate limits
- Advanced analytics
- Historical data
- Priority support

**Best Practices**:
1. Implement rate limiting queue
2. Use exponential backoff on errors
3. Cache frequently accessed data
4. Batch requests when possible

---

## üîê Authentication

All requests require an API key:

```bash
# Request format
https://api.etherscan.io/v2/api?chainid=1&module=account&action=balance&address=0x...&apikey=YOUR_API_KEY
```

**Getting API Keys**:
1. Visit respective block explorer
2. Create account
3. Generate API key
4. Add to `.env` file

---

## üîó Integration with TheWarden

### 1. Transaction Monitoring

```typescript
async function monitorArbitrageTx(txHash: string) {
  const status = await etherscan.transaction.getStatus(txHash);
  if (status.isError === '0') {
    logger.info('Arbitrage successful ‚úÖ');
    return true;
  } else {
    logger.error('Arbitrage failed ‚ùå');
    return false;
  }
}
```

### 2. Event-Driven Arbitrage

```typescript
async function scanForOpportunities() {
  const swaps = await etherscan.logs.getLogs({
    address: UNISWAP_V3_POOL,
    topic0: SWAP_EVENT_TOPIC,
    fromBlock: currentBlock - 10,
    toBlock: 'latest'
  });
  
  return analyzeSwapsForArbitrage(swaps);
}
```

### 3. Gas Optimization

```typescript
async function getOptimalGas() {
  const oracle = await etherscan.gas.getOracle();
  const urgency = assessUrgency();
  
  return urgency === 'high' 
    ? oracle.FastGasPrice 
    : oracle.ProposeGasPrice;
}
```

### 4. Contract Verification

```typescript
async function verifyContractSafety(address: string) {
  const source = await etherscan.contract.getSourceCode(address);
  
  if (!source[0].SourceCode) {
    throw new Error('Unverified contract - RISKY!');
  }
  
  return {
    verified: true,
    name: source[0].ContractName,
    compiler: source[0].CompilerVersion
  };
}
```

---

## üéØ Best Practices

### 1. Caching

```typescript
// Cache contract ABIs (they don't change)
const abiCache = new Map<string, string>();

async function getCachedABI(address: string) {
  if (abiCache.has(address)) {
    return abiCache.get(address)!;
  }
  
  const abi = await etherscan.contract.getABI(address);
  abiCache.set(address, abi);
  return abi;
}
```

### 2. Rate Limiting

```typescript
import PQueue from 'p-queue';

const queue = new PQueue({
  concurrency: 1,
  interval: 200, // 5/sec
  intervalCap: 1
});

async function rateLimitedCall<T>(fn: () => Promise<T>): Promise<T> {
  return queue.add(fn);
}
```

### 3. Error Handling

```typescript
async function safeCall<T>(
  fn: () => Promise<T>,
  retries = 3
): Promise<T | null> {
  for (let i = 0; i < retries; i++) {
    try {
      return await fn();
    } catch (error) {
      if (error.message.includes('rate limit')) {
        await sleep(1000 * (i + 1)); // Exponential backoff
        continue;
      }
      throw error;
    }
  }
  return null;
}
```

### 4. Batch Operations

```typescript
// Get multiple balances in one call
const balances = await etherscan.account.getBalanceMulti([
  '0xAddress1',
  '0xAddress2',
  '0xAddress3'
]);
```

---

## üìä Monitoring

Track API usage:

```typescript
class EtherscanMonitor {
  private callCount = 0;
  private errorCount = 0;
  
  trackCall(success: boolean) {
    this.callCount++;
    if (!success) this.errorCount++;
    
    if (this.callCount % 100 === 0) {
      const successRate = ((1 - this.errorCount/this.callCount) * 100).toFixed(2);
      console.log(`Etherscan Stats:`);
      console.log(`  Calls: ${this.callCount}`);
      console.log(`  Errors: ${this.errorCount}`);
      console.log(`  Success: ${successRate}%`);
    }
  }
}
```

---

## üìö Additional Resources

- **Official Docs**: https://docs.etherscan.io/
- **API Playground**: https://etherscan.io/apis
- **Status Page**: https://status.etherscan.io/
- **Community**: https://etherscan.io/forum

---

## üîÆ Future Enhancements

- [ ] WebSocket support for real-time data
- [ ] Advanced query builder
- [ ] Automated retry strategies
- [ ] Response caching layer
- [ ] Multi-chain portfolio aggregation
- [ ] Event stream subscriptions

---

**Autonomously Generated by TheWarden**  
**Last Updated**: 2025-12-21  
**For detailed module docs, see module-specific files in this directory**
